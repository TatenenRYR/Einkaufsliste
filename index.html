function renderList() {
  const listEl = document.getElementById('list');
  listEl.innerHTML = '';

  // Sortiere die Liste nach Kategorie und dann Name
  const sortedList = [...list].sort((a, b) =>
    a.category.localeCompare(b.category) || a.name.localeCompare(b.name)
  );

  sortedList.forEach((item, idx) => {
    const div = document.createElement('div');
    div.className = 'item';
    const icon = getCategoryIcon(item.category, item.name);
    const realIndex = list.findIndex(i => i.name === item.name && i.category === item.category);

    div.innerHTML = `
      <div class="info"><span class="item-icon">${icon}</span>
        <span class="item-name${item.checked ? ' checked' : ''}">
          ${item.name} <span class="quantity">x${item.qty}</span>
        </span>
      </div>
      <div class="actions">
        <button onclick="toggleItem(${realIndex})">${item.checked ? '↺' : '✔'}</button>
        <button onclick="changeQty(${realIndex}, -1)">−</button>
        <button onclick="changeQty(${realIndex}, 1)">+</button>
        <button onclick="editItem(${realIndex})">✎</button>
        <button onclick="deleteItem(${realIndex})">✖</button>
      </div>`;
    div.querySelector('.info').addEventListener('click', () => toggleItem(realIndex));
    listEl.appendChild(div);
  });
}

function deleteItem(i) {
  if (confirm(`"${list[i].name}" wirklich löschen?`)) {
    list.splice(i, 1);
    saveList();
    renderList();
  }
}

function editItem(i) {
  const newName = prompt('Neuer Produktname:', list[i].name);
  if (newName && newName.trim() !== '') {
    const newCategory = prompt('Neue Kategorie:', list[i].category) || detectCategory(newName);
    list[i].name = newName.trim();
    list[i].category = newCategory.trim();
    saveList();
    renderList();
  }
}
