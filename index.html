<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Einkaufsliste</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body { font-family: sans-serif; background: #f6fff6; color: #123; padding: 1em; }
    input, button { padding: 0.5em; margin: 0.2em; }
    .produkt { display: flex; align-items: center; gap: 0.5em; padding: 0.5em; border-bottom: 1px solid #ccc; }
    .erledigt { text-decoration: line-through; opacity: 0.5; }
  </style>
</head>
<body>
  <h1>Einkaufsliste</h1>
  <input id="produktInput" placeholder="Produkt" />
  <input id="mengeInput" placeholder="Menge" />
  <input id="marktInput" placeholder="Markt" />
  <button onclick="hinzufuegen()">Hinzufügen</button>
  <button onclick="teileURL()">URL teilen</button>

  <div id="liste"></div>

  <script>
    let produkte = JSON.parse(localStorage.getItem("produkte") || "[]");

    function erkenneKategorieUndIcon(name) {
      const n = name.toLowerCase();
      const kategorien = [
        { kategorie: "Getränke", icon: "bi-cup-straw", keywords: ["cola", "wasser", "saft", "bier", "wein", "säfte"] },
        { kategorie: "Obst", icon: "bi-apple", keywords: ["apfel", "banane", "birne", "orange", "traube", "kiwi"] },
        { kategorie: "Salat", icon: "bi-emoji-smile", keywords: ["salat", "gurke", "tomate", "paprika"] },
        { kategorie: "Eier", icon: "bi-egg", keywords: ["ei", "eier"] },
        { kategorie: "Backwaren", icon: "bi-basket", keywords: ["brot", "brötchen", "brote", "croissant"] },
        { kategorie: "Milchprodukte", icon: "bi-box", keywords: ["milch", "joghurt", "käse", "quark"] },
        { kategorie: "Aufschnitt", icon: "bi-list-ul", keywords: ["wurst", "aufschnitt", "schinken", "salami"] },
        { kategorie: "Fleisch", icon: "bi-egg-fried", keywords: ["hackfleisch", "fleisch", "steak", "hähnchen"] },
        { kategorie: "Körperpflege", icon: "bi-heart-pulse", keywords: ["zahnpasta", "seife", "shampoo", "deo"] },
        { kategorie: "Haushalt", icon: "bi-house", keywords: ["spülmittel", "reiniger", "putzmittel"] },
        { kategorie: "Hygieneartikel", icon: "bi-droplet", keywords: ["weichspüler", "toilettenpapier", "taschentücher"] }
      ];

      for (const kat of kategorien) {
        if (kat.keywords.some(kw => n.includes(kw))) {
          return { kategorie: kat.kategorie, icon: kat.icon };
        }
      }
      return { kategorie: "Sonstiges", icon: "bi-bag" };
    }

    function speichereProdukte() {
      localStorage.setItem("produkte", JSON.stringify(produkte));
      zeigeProdukte();
    }

    function zeigeProdukte() {
      const liste = document.getElementById("liste");
      liste.innerHTML = "";
      produkte.forEach(p => {
        const div = document.createElement("div");
        div.className = "produkt" + (p.erledigt ? " erledigt" : "");
        div.innerHTML = `<i class="bi ${p.icon}"></i> <strong>${p.name}</strong> (${p.menge}) <small>${p.markt}</small>`;
        div.onclick = () => {
          p.erledigt = !p.erledigt;
          speichereProdukte();
        };
        liste.appendChild(div);
      });
    }

    function hinzufuegen() {
      const name = document.getElementById('produktInput').value.trim();
      let menge = document.getElementById('mengeInput').value.trim();
      const markt = document.getElementById('marktInput').value.trim();
      if (!name) return;
      if (!menge) menge = "1 Stück";

      const { kategorie, icon } = erkenneKategorieUndIcon(name);
      const match = menge.match(/(\d+)(\s*\w*)/);
      let neueMenge = 1;
      let einheit = "Stück";
      if (match) {
        neueMenge = parseInt(match[1]);
        einheit = match[2].trim() || "Stück";
      }

      const vorhandenesProdukt = produkte.find(p => p.name.toLowerCase() === name.toLowerCase() && p.markt === markt);

      if (vorhandenesProdukt) {
        const vorhandeneMatch = vorhandenesProdukt.menge.match(/(\d+)(\s*\w*)/);
        let vorhandeneMenge = 1;
        if (vorhandeneMatch) {
          vorhandeneMenge = parseInt(vorhandeneMatch[1]);
        }
        vorhandenesProdukt.menge = `${vorhandeneMenge + neueMenge} ${einheit}`;
      } else {
        const id = Date.now();
        produkte.push({ id, name, menge: `${neueMenge} ${einheit}`, markt, kategorie, icon, erledigt: false });
      }

      speichereProdukte();
      document.getElementById('produktInput').value = '';
      document.getElementById('mengeInput').value = '';
      document.getElementById('marktInput').value = '';
    }

    function teileURL() {
      if (navigator.share) {
        navigator.share({ title: document.title, url: window.location.href }).catch(console.error);
      } else {
        alert("Teilen wird von deinem Browser nicht unterstützt.");
      }
    }

    zeigeProdukte();
  </script>
</body>
</html>
