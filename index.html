<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Einkaufsliste</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>
<body>
  <h1>Einkaufsliste</h1>
  <input id="produktInput" type="text" placeholder="Produktname">
  <input id="mengeInput" type="text" placeholder="Menge">
  <button onclick="addProdukt()">Hinzuf√ºgen</button>
  <ul id="liste"></ul><button onclick="zeigeQR()">QR-Code anzeigen</button>

  <div id="qrCodeCanvas"></div><button onclick="toggleScanner()">Barcode Scanner Start/Stopp</button>

  <div id="reader" style="width: 300px;"></div>  <script>
    let produkte = [];

    function addProdukt() {
      const name = document.getElementById("produktInput").value;
      const menge = document.getElementById("mengeInput").value;
      if (!name || !menge) return;
      produkte.push({ name, menge });
      renderListe();
    }

    function renderListe() {
      const ul = document.getElementById("liste");
      ul.innerHTML = '';
      produkte.forEach((p, index) => {
        const li = document.createElement("li");
        li.textContent = `${p.name} (${p.menge})`;
        ul.appendChild(li);
      });
    }

    function zeigeQR() {
      const canvas = document.createElement("canvas");
      document.getElementById("qrCodeCanvas").innerHTML = '';
      document.getElementById("qrCodeCanvas").appendChild(canvas);
      QRCode.toCanvas(canvas, JSON.stringify(produkte), { width: 256 }, (error) => {
        if (error) console.error(error);
      });
    }

    let qrScanner;
    let scannerRunning = false;

    function toggleScanner() {
      if (scannerRunning) {
        qrScanner.stop().then(() => {
          qrScanner.clear();
          scannerRunning = false;
        });
      } else {
        qrScanner = new Html5Qrcode("reader");
        qrScanner.start(
          { facingMode: "environment" },
          { fps: 10, qrbox: 250 },
          (decodedText, decodedResult) => {
            alert("Gescannt: " + decodedText);
          },
          (errorMessage) => {
            console.warn(errorMessage);
          }
        ).then(() => {
          scannerRunning = true;
        }).catch(err => {
          console.error("Kamera konnte nicht gestartet werden.", err);
        });
      }
    }
  </script></body>
</html>
