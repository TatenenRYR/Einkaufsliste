<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lokale Einkaufsliste</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 1rem;
      padding: 0;
      background-color: #f9f9f9;
    }
    h1 {
      text-align: center;
    }
    input, select, button {
      padding: 0.5rem;
      margin: 0.3rem 0;
      width: 100%;
      font-size: 1rem;
      box-sizing: border-box;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      padding: 0.6rem;
      border-bottom: 1px solid #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    .kategorie {
      font-style: italic;
      color: #666;
      font-size: 0.9rem;
    }
    .aktionen button {
      margin-left: 0.3rem;
    }
    .produkt-icon {
      width: 24px;
      height: 24px;
      margin-right: 0.5rem;
    }
    .produkt-name {
      display: flex;
      align-items: center;
    }
  </style>
</head>
<body>
  <h1>Lokale Einkaufsliste</h1>  <input type="text" id="produktInput" list="vorschlaege" placeholder="Produktname...">
  <datalist id="vorschlaege"></datalist>
  <input type="text" id="mengeInput" placeholder="Menge (z.â€¯B. 2 StÃ¼ck)">
  <input type="text" id="marktInput" placeholder="Markt / Laden (optional)">
  <button onclick="hinzufuegen()">HinzufÃ¼gen</button><label for="sortKategorie">Nach Kategorie sortieren:</label> <select id="sortKategorie" onchange="renderListe()"> <option value="">Keine Sortierung</option> </select>

<label for="sortMarkt">Nach Markt sortieren:</label> <select id="sortMarkt" onchange="renderListe()"> <option value="">Alle MÃ¤rkte</option> </select>

<button onclick="exportiereQR()">Liste per QR-Code teilen</button>

  <ul id="liste"></ul>  <div id="qrCode"></div>  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>  <script>
    let produkte = JSON.parse(localStorage.getItem("produkte")) || [];
    const iconMap = {
      "Cola": "ðŸ¥¤", "Wasser": "ðŸ’§", "Milch": "ðŸ¥›", "Brot": "ðŸž", "KÃ¤se": "ðŸ§€",
      "Ã„pfel": "ðŸŽ", "Bananen": "ðŸŒ", "Eier": "ðŸ¥š", "Fleisch": "ðŸ¥©",
      "GetrÃ¤nk": "ðŸ¥¤", "Obst": "ðŸŽ", "GemÃ¼se": "ðŸ¥¦", "Milchprodukte": "ðŸ¥›", "Backwaren": "ðŸž",
      "Sonstiges": "ðŸ›’"
    };
    const produktVorschlaege = ["Cola", "Wasser", "Milch", "Brot", "KÃ¤se", "Ã„pfel", "Bananen", "Eier", "Fleisch"];

    function speichereProdukte() {
      localStorage.setItem("produkte", JSON.stringify(produkte));
    }

    function hinzufuegen() {
      const name = document.getElementById('produktInput').value.trim();
      const menge = document.getElementById('mengeInput').value.trim();
      const markt = document.getElementById('marktInput').value.trim();
      if (!name || !menge) return;
      const kategorie = erkenneKategorie(name);
      const id = Date.now();
      produkte.push({ id, name, menge, kategorie, markt });
      if (!produktVorschlaege.includes(name)) produktVorschlaege.push(name);
      speichereProdukte();
      document.getElementById('produktInput').value = '';
      document.getElementById('mengeInput').value = '';
      document.getElementById('marktInput').value = '';
      renderListe();
      aktualisiereKategorieDropdown();
      aktualisiereMarktDropdown();
      aktualisiereVorschlaege();
    }

    function erkenneKategorie(name) {
      name = name.toLowerCase();
      if (name.includes("cola") || name.includes("wasser") || name.includes("saft")) return "GetrÃ¤nk";
      if (name.includes("apfel") || name.includes("banane") || name.includes("obst")) return "Obst";
      if (name.includes("salat") || name.includes("tomate") || name.includes("gemÃ¼se")) return "GemÃ¼se";
      if (name.includes("milch") || name.includes("joghurt")) return "Milchprodukte";
      if (name.includes("brot") || name.includes("brÃ¶tchen")) return "Backwaren";
      return "Sonstiges";
    }

    function aendereMenge(id, delta) {
      const produkt = produkte.find(p => p.id === id);
      const match = produkt.menge.match(/(\d+)(\s*[^\d]*)/);
      if (match) {
        let zahl = parseInt(match[1]);
        const einheit = match[2];
        zahl += delta;
        if (zahl <= 0) {
          produkte = produkte.filter(p => p.id !== id);
        } else {
          produkt.menge = `${zahl}${einheit}`.trim();
        }
        speichereProdukte();
        renderListe();
      }
    }

    function renderListe() {
      const kategorieFilter = document.getElementById("sortKategorie").value;
      const marktFilter = document.getElementById("sortMarkt").value;
      const ul = document.getElementById("liste");
      ul.innerHTML = '';
      const gefiltert = produkte.filter(p =>
        (!kategorieFilter || p.kategorie === kategorieFilter) &&
        (!marktFilter || p.markt === marktFilter)
      );
      gefiltert.forEach(p => {
        const icon = iconMap[p.name] || iconMap[p.kategorie] || "ðŸ›’";
        const li = document.createElement('li');
        li.innerHTML = `<span class="produkt-name">${icon} <strong>${p.name}</strong> (${p.menge})</span>
          <span class="kategorie">${p.kategorie}${p.markt ? ' @ ' + p.markt : ''}</span>
          <span class="aktionen">
            <button onclick="aendereMenge(${p.id}, 1)">+</button>
            <button onclick="aendereMenge(${p.id}, -1)">-</button>
          </span>`;
        ul.appendChild(li);
      });
    }

    function aktualisiereKategorieDropdown() {
      const dropdown = document.getElementById("sortKategorie");
      const kategorien = [...new Set(produkte.map(p => p.kategorie))];
      const aktuelleAuswahl = dropdown.value;
      dropdown.innerHTML = '<option value="">Keine Sortierung</option>';
      kategorien.forEach(k => {
        const option = document.createElement("option");
        option.value = k;
        option.textContent = k;
        dropdown.appendChild(option);
      });
      dropdown.value = aktuelleAuswahl;
    }

    function aktualisiereMarktDropdown() {
      const dropdown = document.getElementById("sortMarkt");
      const maerkte = [...new Set(produkte.map(p => p.markt).filter(Boolean))];
      const aktuelleAuswahl = dropdown.value;
      dropdown.innerHTML = '<option value="">Alle MÃ¤rkte</option>';
      maerkte.forEach(k => {
        const option = document.createElement("option");
        option.value = k;
        option.textContent = k;
        dropdown.appendChild(option);
      });
      dropdown.value = aktuelleAuswahl;
    }

    function aktualisiereVorschlaege() {
      const vorschlaege = document.getElementById("vorschlaege");
      vorschlaege.innerHTML = '';
      produktVorschlaege.forEach(name => {
        const option = document.createElement("option");
        option.value = name;
        vorschlaege.appendChild(option);
      });
    }

    function exportiereQR() {
      const qrContainer = document.getElementById("qrCode");
      qrContainer.innerHTML = '';
      const qr = new QRious({
        value: JSON.stringify(produkte),
        size: 250
      });
      qrContainer.appendChild(qr.image);
    }

    renderListe();
    aktualisiereKategorieDropdown();
    aktualisiereMarktDropdown();
    aktualisiereVorschlaege();
  </script></body>
</html>
