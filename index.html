<!DOCTYPE html><html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Einkaufsliste mit Barcode-Scan</title>
  <script type="module" src="https://unpkg.com/@zxing/browser@latest"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f1fdf4;
      margin: 1rem;
      color: #333;
    }h1, h3 {
  text-align: center;
  color: #2d7a46;
}

input, button, select {
  width: 100%;
  padding: 0.6rem;
  margin: 0.4rem 0;
  box-sizing: border-box;
  border: 1px solid #ccc;
  border-radius: 6px;
}

button {
  background-color: #4CAF50;
  color: white;
  border: none;
  cursor: pointer;
}

button:hover {
  background-color: #45a049;
}

ul {
  list-style-type: none;
  padding: 0;
}

li {
  padding: 0.8rem;
  border-bottom: 1px solid #ddd;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  background: white;
  border-radius: 6px;
  margin-bottom: 0.5rem;
}

.aktionen button {
  margin-left: 0.3rem;
}

.kategorie {
  font-style: italic;
  font-size: 0.85rem;
  color: #666;
}

.produkt-info {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  cursor: pointer;
}

.produkt-info i {
  font-size: 1.4rem;
  color: #2d7a46;
}

.erledigt {
  text-decoration: line-through;
  opacity: 0.6;
}

#scannerContainer {
  display: none;
  position: relative;
}

#video {
  width: 100%;
  border-radius: 8px;
}

#canvasOverlay {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 2;
  pointer-events: none;
}

  </style>
</head>
<body>
  <h1>Einkaufsliste</h1>
  <input type="text" id="produktInput" placeholder="Produktname...">
  <input type="text" id="mengeInput" placeholder="Menge (z. B. 2 Stück)">
  <input type="text" id="marktInput" placeholder="Markt (optional)">
  <button onclick="hinzufuegen()">Hinzufügen</button>
  <button onclick="toggleScanner()">Barcode scannen</button>  <div id="scannerContainer">
    <video id="video" muted autoplay></video>
    <canvas id="canvasOverlay"></canvas>
  </div>  <ul id="liste"></ul>  <script type="module">
    import { BrowserMultiFormatReader, NotFoundException } from 'https://unpkg.com/@zxing/browser@latest';

    let produkte = JSON.parse(localStorage.getItem("produkte") || "[]");
    const codeReader = new BrowserMultiFormatReader();
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvasOverlay");
    const ctx = canvas.getContext("2d");
    let scannerActive = false;

    function speichere() {
      localStorage.setItem("produkte", JSON.stringify(produkte));
    }

    function render() {
      const liste = document.getElementById("liste");
      liste.innerHTML = "";
      produkte.forEach(p => {
        const li = document.createElement("li");
        li.innerHTML = `
          <span class="produkt-info ${p.erledigt ? 'erledigt' : ''}" onclick="toggleErledigt(${p.id})">
            <i class="bi bi-cart"></i>
            <span><strong>${p.name}</strong> (${p.menge})<br><span class="kategorie">${p.kategorie}${p.markt ? ' @ ' + p.markt : ''}</span></span>
          </span>
          <span class="aktionen">
            <button onclick="aendereMenge(${p.id},1)">+</button>
            <button onclick="aendereMenge(${p.id},-1)">-</button>
          </span>`;
        liste.appendChild(li);
      });
    }

    window.toggleErledigt = function(id) {
      const eintrag = produkte.find(e => e.id === id);
      if (eintrag) {
        eintrag.erledigt = !eintrag.erledigt;
        speichere();
        render();
      }
    }

    window.aendereMenge = function(id, delta) {
      const eintrag = produkte.find(e => e.id === id);
      if (!eintrag) return;
      const match = eintrag.menge.match(/(\d+)(\D*)/);
      if (!match) return;
      let anzahl = parseInt(match[1]) + delta;
      if (anzahl < 1) {
        produkte = produkte.filter(e => e.id !== id);
      } else {
        eintrag.menge = anzahl + match[2];
      }
      speichere();
      render();
    }

    window.hinzufuegen = function(name = null, menge = null, markt = null) {
      name = name || document.getElementById("produktInput").value.trim();
      menge = menge || document.getElementById("mengeInput").value.trim() || "1 Stück";
      markt = markt || document.getElementById("marktInput").value.trim();
      if (!name) return;
      const kategorie = erkenneKategorie(name);
      produkte.push({ id: Date.now(), name, menge, markt, kategorie, erledigt: false });
      speichere();
      render();
      document.getElementById("produktInput").value = '';
      document.getElementById("mengeInput").value = '';
      document.getElementById("marktInput").value = '';
    }

    function erkenneKategorie(text) {
      const t = text.toLowerCase();
      if (t.includes("cola") || t.includes("wasser") || t.includes("bier")) return "Getränke";
      if (t.includes("brot")) return "Backwaren";
      if (t.includes("käse") || t.includes("milch")) return "Milchprodukte";
      return "Sonstiges";
    }

    window.toggleScanner = async function() {
      const container = document.getElementById("scannerContainer");
      if (scannerActive) {
        codeReader.reset();
        container.style.display = "none";
        scannerActive = false;
        return;
      }

      container.style.display = "block";
      canvas.width = video.clientWidth;
      canvas.height = video.clientHeight;

      codeReader.decodeFromVideoDevice(null, video, (result, err) => {
        if (result) {
          zeichneBox(result.resultPoints);
          hinzufuegen(result.text);
          alert("Gefunden: " + result.text);
          toggleScanner();
        } else {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
      });

      scannerActive = true;
    }

    function zeichneBox(punkte) {
      if (!punkte || punkte.length < 2) return;
      const xs = punkte.map(p => p.x);
      const ys = punkte.map(p => p.y);
      const x = Math.min(...xs);
      const y = Math.min(...ys);
      const w = Math.max(...xs) - x;
      const h = Math.max(...ys) - y;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = "red";
      ctx.lineWidth = 4;
      ctx.strokeRect(x, y, w, h);
    }

    render();
  </script></body>
</html>
